<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/bootstrap.css">
    <link rel="stylesheet" href="./icon.css">
    <title>Medical Chat bot</title>
</head>
<body>
    <div class="position-relative d-flex h-100 w-100 overflow-hidden">
        <!-- Sidebar -->
        <div class="flex-column flex d-flex position-relative w-100 h-100 flex-shrink-0" style=" width: 260px !important; overflow-x: hidden;">
            <div class="h-100" style="width: 260px;">
                <div id="sidebar">
                    <div class="h-100 px-3 d-flex flex-column align-items-center align-items-sm-start pt-3 min-vh-100">            
                        <div class="d-flex nav-item justify-content-between w-100">
                            <div>QAI bot</div> 
                            <button>
                              <i class="fa-solid fa-bars"></i>
                            </button>
                        </div>
                        <ul class="d-flex frame nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start">
                            <li class="chatBox nav-item">chat box 1</li>
                            
                            <li class="chatBox nav-item">chat box 1</li>
                            <li class="chatBox nav-item">chat box 1</li>
                        </ul>
                        <div class="d-flex align-items-center align-items-sm-start w-100 my-3 justify-content-center">
                            <button class="btn btn-primary">report issue</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="flex-column overflow-hidden flex-1 position-relative d-flex h-100 mw-100" style="height: 100vh">
            <main class="position-relative flex-1 h-100 w-100 overflow-auto">
                <div role="presentation" tabindex="0" id="body" class="w-100">
                    <div class="flex-1 overflow-hidden">
                      <div class="h-100">
                        <div class="position-relative h-100">
                          <div class="h-100 w-100" style="overflow-y: auto;">
                            <!-- Navbar -->
                            <div id="navbar" class="justify-content-between">
                                <h1 class="title">Medical Chat bot</h1>
                                <div style="line-height: 50px;">
                                  <button class="login">
                                    <i class="fa-solid fa-user"></i>
                                    login
                                  </button>
                                </div>
                            </div>
                            <div id="chatting">        
                                <div class="ib_bot">
                                    <p>Xin chào bạn, Tôi là chat bot hổ trọ việc chuẩn đoán y tế cho bạn.</p>
                                    <p>Để hổ trợ cho việc chuẩn đoán bạn có thể trả lời các câu hỏi của tôi được chứ!</p>
                                </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="input-message w-100">
                        <input type="text" id="userInput" placeholder="type message here" onkeyup="sendQuery(event)">
                        <button id="send">Send</button>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script>
        const chatting = document.getElementById('chatting');
        const input = document.getElementById('userInput');
        const sendButton = document.getElementById('send');
        let step = 1;
        let userInfo = {};
    
        function addMessage(content, sender) {
          const div = document.createElement('div');
          if (sender === 'User') {
            div.innerHTML = `<div class="ib_user"><div><p>${content}</p></div></div>`;
          } else {
            div.innerHTML = `<div class="ib_bot"><p>${content}</p></div>`;
          }
          chatting.appendChild(div);
        }
    
        function sendQuery(event) {
          if (event.key === 'Enter' || event.type === 'click') {
            const userMessage = input.value.trim();
            if (userMessage) {
              addMessage(userMessage, 'User');
              input.value = '';
    
              // Save user response
              switch (step) {
                case 2:
                  userInfo.fullName = userMessage;
                  break;
                case 3:
                  userInfo.age = userMessage;
                  break;
                case 4:
                  userInfo.gender = userMessage;
                  break;
                case 5:
                  userInfo.contact = userMessage;
                  // step = 34;
                  // saveUserInfoToDatabase(userInfo);
                  break;
                case 6:
                  userInfo.symptoms = userMessage;
                  break;
                case 7:
                  userInfo.firstTime = userMessage;
                  break;
                case 8:
                  userInfo.howLong = userMessage;
                  break;
                case 9:
                  userInfo.symptomContent = userMessage;
                  break;
                case 10:
                  userInfo.hurtPosition = userMessage;
                  break;
                case 11:
                  userInfo.isExtend = userMessage;
                  break;
                case 12:
                  userInfo.thingAffect = userMessage;
                  break;
                case 13:
                  userInfo.rateHurt = userMessage;
                  break;
                case 14:
                  userInfo.Frequency = userMessage;
                  break;
                  case 15:
                  userInfo.chronic = userMessage;
                  break;
                case 16:
                  userInfo.surgery = userMessage;
                  break;
                case 17:
                  userInfo.isTreatmenting = userMessage;
                  break;
                case 18:
                  userInfo.diagnosisYet = userMessage;
                  break;
                case 19:
                  userInfo.medicalYet = userMessage;
                  break;
                case 20:
                  userInfo.medicineAmount = userMessage;
                  break;
                case 21:
                  userInfo.sideEffect = userMessage;
                  break;
                case 22:
                  userInfo.medicalAllergy = userMessage;
                  break;
                case 23:
                  userInfo.anyPatient = userMessage;
                  break;
                case 24:
                  userInfo.geneticDisease = userMessage;
                  break;
                case 25:
                  userInfo.isSmoke = userMessage;
                  break;
                case 26:
                  userInfo.weight = userMessage;
                  break;
                case 27:
                  userInfo.bodyIssues = userMessage;
                  break;
                case 28:
                  userInfo.habitChanges = userMessage;
                  break;
                case 29:
                  userInfo.allergy = userMessage;
                  break;
                case 30:
                  userInfo.addictiveReact = userMessage;
                  break;
                case 31:
                  userInfo.mentalHealthStatus = userMessage;
                  step = 34;
                  saveUserInfoToDatabase(userInfo); // Save userInfo to the database
                  break;
              }
    
              // Fetch response from the server
              const res = fetch(`http://localhost:3000/chatbot?step=${step}`)
                .then(response => response.json())
                .then(data => {
                  addMessage(data.response, 'Bot');
                  step++;
                });
              
              console.log(res);
            }
          }
        }
        
        function saveUserInfoToDatabase(userInfo) {
          // Your database saving logic here
          fetch('http://localhost:3000/saveUserInfo', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(userInfo)
          })
          .then(response => response.json())
          .then(data => {
            console.log('Success:', data);
          })
          .catch((error) => {
            console.error('Error:', error);
          });
        }

        sendButton.addEventListener('click', sendQuery);
    </script>
</body>
</html>

